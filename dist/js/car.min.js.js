"use strict";$(function(){function d(){var e=$(".piece_num").html(),t=$(".total_text").html(),a=$(".calBtn a");0!=t&&0!=e?a.hasClass("btn_sty")||a.addClass("btn_sty"):a.hasClass("btn_sty")&&a.removeClass("btn_sty")}$("h1").on("click",function(){location.href="../index.html"}),autoCar("../",function(e){$(".car_none").css("display","none"),$(".car_have").css("display","block"),$(".order_content").html("");var c=0,t=e.adminlist.map(function(e){var t=e.imgurl1,a=e.qty*e.cutprice,n=(c=++c)-1;return'<ul class="order_lists" data-id="'+e.goodsid+'">\n                        <li class="list_chk">\n                            <input type="checkbox" id="checkbox_'+n+'" class="son_check">\n                            <label for="checkbox_'+n+'"></label>\n                        </li>\n                        <li class="list_con">\n                            <div class="list_img"><a href="javascript:;"><img src="'+t+'" alt=""></a></div>\n                            <div class="list_text"><a href="javascript:;">'+e.name+'</a></div>\n                        </li>\n                        <li class="list_info">\n                            <p>商品id号：blsh'+e.goodsid+"</p>\n                            <p>商品追加时间："+e.timer+'</p>\n                        </li>\n                        <li class="list_price">\n                        <p class="price">￥<span>'+e.cutprice+'</span></p>\n                        </li>\n                        <li class="list_amount">\n                            <div class="amount_box">\n                                <a href="javascript:;" class="reduce reSty">-</a>\n                                <input type="text" value="'+e.qty+'" class="sum">\n                                <a href="javascript:;" class="plus">+</a>\n                            </div>\n                        </li>\n                        <li class="list_sum">\n                        <p class="sum_price">￥ <span class="sum_idprice">'+a.toFixed(2)+'</span></p>\n                        </li>\n                        <li class="list_op">\n                            <p class="del"><a href="javascript:;" class="delBtn">移除商品</a></p>\n                        </li>\n                    </ul>'}).join("");$(".order_content").html(t)},function(){$(".car_none").css("display","block"),$(".car_have").css("display","none")},function(){$(".car_none").css("display","block"),$(".car_have").css("display","none")}),$(".car_have").on("click","input",function(){$(this).is(":checked")?$(this).next("label").addClass("mark"):$(this).next("label").removeClass("mark")}),$(".car_have").on("click",".whole_check",function(){if($(this).is(":checked")){$(this).prop("checked","checked"),$(this).next("label").addClass("mark"),$(this).parent().parent().parent().next(".cartBox").find(".son_check").prop("checked","checked"),$(this).parent().parent().parent().next(".cartBox").find("label").addClass("mark"),$(".whole_check2").prop("checked","checked"),$(".whole_check2").next().addClass("mark");for(var e=$(this).parent().parent().parent().next(".cartBox").find(".sum"),t=0,a=0;a<e.length;a++)t+=Number(e[a].value);$(".piece_num").html(t);var n=$(this).parent().parent().parent().next(".cartBox").find(".sum_idprice"),c=0;for(a=0;a<n.length;a++)c+=Number(n[a].innerHTML);$(".total_text").html(c.toFixed(2))}else $(this).removeAttr("checked"),$(this).next("label").removeClass("mark"),$(this).parent().parent().parent().next(".cartBox").find(".son_check").removeAttr("checked"),$(this).parent().parent().parent().next(".cartBox").find("label").removeClass("mark"),$(".whole_check2").removeAttr("checked"),$(".whole_check2").next().removeClass("mark"),$(".piece_num").html(0),$(".total_text").html(0);d()}),$(".car_have").on("click",".whole_check2",function(){if($(this).is(":checked")){$(this).prop("checked","checked"),$(this).next("label").addClass("mark"),$(this).parent().parent().parent().prev(".cartBox").find(".son_check").prop("checked","checked"),$(this).parent().parent().parent().prev(".cartBox").find("label").addClass("mark"),$(".whole_check").prop("checked","checked"),$(".whole_check").next().addClass("mark");for(var e=$(this).parent().parent().parent().prev(".cartBox").find(".sum"),t=0,a=0;a<e.length;a++)t+=Number(e[a].value);$(".piece_num").html(t);var n=$(this).parent().parent().parent().prev(".cartBox").find(".sum_idprice"),c=0;for(a=0;a<n.length;a++)c+=Number(n[a].innerHTML);$(".total_text").html(c.toFixed(2))}else $(this).removeAttr("checked"),$(this).next("label").removeClass("mark"),$(this).parent().parent().parent().prev(".cartBox").find(".son_check").removeAttr("checked"),$(this).parent().parent().parent().prev(".cartBox").find("label").removeClass("mark"),$(".whole_check").removeAttr("checked"),$(".whole_check").next().removeClass("mark"),$(".piece_num").html(0),$(".total_text").html(0);d()}),$(".cartBox").on("click","input",function(){var e=1*$(".piece_num").html(),t=1*$(".total_text").html(),a=1*$(this).parent().parent().find(".sum").val(),n=1*$(this).parent().parent().find(".sum_idprice").html();if($(this).is(":checked")){$(this).prop("checked","checked"),$(this).next("label").addClass("mark");var c=$(this).parent().parent().parent().find(".mark"),r=$(this).parent().parent().parent().find("label");$(".piece_num").html(e+a),$(".total_text").html((t+n).toFixed(2)),c.length==r.length?($(".whole_check").prop("checked","checked"),$(".whole_check").next().addClass("mark"),$(".whole_check2").prop("checked","checked"),$(".whole_check2").next().addClass("mark")):($(".whole_check").removeAttr("checked"),$(".whole_check").next().removeClass("mark"),$(".whole_check2").removeAttr("checked"),$(".whole_check2").next().removeClass("mark"))}else $(this).removeAttr("checked"),$(this).next("label").removeClass("mark"),$(".whole_check").removeAttr("checked"),$(".whole_check").next().removeClass("mark"),$(".whole_check2").removeAttr("checked"),$(".whole_check2").next().removeClass("mark"),$(".piece_num").html(e-a),$(".total_text").html((t-n).toFixed(2));d()}),$(".cartBox").on("click",".plus",function(){if($(this).parent().parent().parent().find(".son_check").is(":checked"))var e=0,t=0;else e=1*$(this).prev().val(),t=1*$(this).parent().parent().parent().find(".sum_idprice").html();var a=$(this).prev().val();100<=++a&&(a=100),$(this).prev().val(a),$(this).parent().parent().parent().find(".son_check").prop("checked","checked"),$(this).parent().parent().parent().find("label").addClass("mark");var n=1*$(this).prev().val(),c=1*$(this).parent().parent().parent().find(".price span").html(),r=n*c;$(this).parent().parent().parent().find(".sum_idprice").html(r.toFixed(2));var l=1*$(".piece_num").html(),s=1*$(".total_text").html();$(".piece_num").html(l+e+1),$(".total_text").html((s+t+c).toFixed(2));var i=$(this).parent().parent().parent().parent().find(".mark"),h=$(this).parent().parent().parent().parent().find("label");i.length==h.length?($(".whole_check").prop("checked","checked"),$(".whole_check").next().addClass("mark"),$(".whole_check2").prop("checked","checked"),$(".whole_check2").next().addClass("mark")):($(".whole_check").removeAttr("checked"),$(".whole_check").next().removeClass("mark"),$(".whole_check2").removeAttr("checked"),$(".whole_check2").next().removeClass("mark")),d();var o=Cookie.get("uname"),p=$(this).parent().parent().parent().data("id");$.ajax({type:"POST",url:"../api/car.php",data:"admin="+o+"&goodsid="+p+"&addqty=1",success:function(e){console.log("数据库 增加 修改成功")}})}),$(".cartBox").on("click",".reduce",function(){var e=1*$(".piece_num").html(),t=1*$(".total_text").html(),a=1*$(this).parent().parent().parent().find(".price span").html(),n=$(this).parent().parent().parent().find(".son_check").is(":checked");jianno_sum_qty=e+1,jianno_sum_price=t+a;var c=1*$(this).next().val(),r=c;--c<=1&&(c=1),$(this).next().val(c);var l=1*$(this).next().val(),s=l*a;$(this).parent().parent().parent().find(".sum_idprice").html(s.toFixed(2)),n?1<c?($(".piece_num").html(e-1),$(".total_text").html((t-a).toFixed(2))):2==r?($(".piece_num").html(e-1),$(".total_text").html((t-a).toFixed(2))):(jian_sum_qty=e-1,$(".piece_num").html(e),$(".total_text").html(t.toFixed(2))):1<c?($(".piece_num").html(e+l),$(".total_text").html((t+s).toFixed(2))):($(".piece_num").html(jianno_sum_qty),$(".total_text").html(jianno_sum_price.toFixed(2))),$(this).parent().parent().parent().find(".son_check").prop("checked","checked"),$(this).parent().parent().parent().find("label").addClass("mark");var i=$(this).parent().parent().parent().parent().find(".mark"),h=$(this).parent().parent().parent().parent().find("label");i.length==h.length?($(".whole_check").prop("checked","checked"),$(".whole_check").next().addClass("mark"),$(".whole_check2").prop("checked","checked"),$(".whole_check2").next().addClass("mark")):($(".whole_check").removeAttr("checked"),$(".whole_check").next().removeClass("mark"),$(".whole_check2").removeAttr("checked"),$(".whole_check2").next().removeClass("mark")),d();var o=Cookie.get("uname"),p=$(this).parent().parent().parent().data("id");console.log(r),$.ajax({type:"POST",url:"../api/car.php",data:"admin="+o+"&goodsid="+p+"&addqty="+-1+"&valKeepqty="+r,success:function(e){console.log("数据库减 数量 修改成功")}})});var c=!1,r=null,l=null,s=null,i=null,h=null;function o(){$(".model_bg").fadeOut(300),$(".my_model").fadeOut(300)}$(".order_content").on("click",".delBtn",function(){r=$(this).parent().parent().parent(),h=$(this).parent().parent().parent().parent().find("ul").size(),i=$(this).parent().parent().parent().data("id"),console.log(i),$(this).parent().parent().parent().find(".son_check").is(":checked")&&(c=!0,l=1*$(this).parent().parent().parent().find(".amount_box").find("input").val(),s=1*$(this).parent().parent().parent().find(".sum_idprice").html()),$(".model_bg").fadeIn(300),$(".my_model").fadeIn(300)}),$(".closeModel").click(function(){o()}),$(".dialog-close").click(function(){o()}),$(".dialog-sure").click(function(){r.remove();var e=1*$(".piece_num").html(),t=1*$(".total_text").html();c&&($(".piece_num").html(e-l),$(".total_text").html((t-s).toFixed(2))),1==h&&($(".car_have").css("display","none"),$(".car_none").css("display","block")),o();var a=Cookie.get("uname"),n=i;$.ajax({type:"POST",url:"../api/car_delete.php",data:"admin="+a+"&goodsid="+n+"&deleteall=0",success:function(e){console.log(e)}})})});